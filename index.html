<!DOCTYPE html>
<html lang="th" class="scroll-smooth">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>IKIZULIVE Dashboard</title>

<script src="https://cdn.tailwindcss.com"></script>

<script>
tailwind.config = {
  darkMode: 'class',
  theme: {
    extend: {
      fontFamily: {
        sans: ['Inter', 'system-ui', 'sans-serif'],
      }
    }
  }
}
</script>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
.card-hover:hover{
  transform: translateY(-3px);
  box-shadow: 0 15px 25px rgba(0,0,0,0.08);
}
</style>
</head>

<body class="bg-gray-50 dark:bg-gray-950 text-gray-900 dark:text-gray-100 font-sans min-h-screen">

<!-- ================= MOBILE TOP BAR ================= -->
<div class="lg:hidden fixed top-0 left-0 right-0 z-40 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 px-4 py-3 flex items-center justify-between">
  <button onclick="toggleSidebar()" class="text-2xl">☰</button>
  <span class="font-semibold">IKIZULIVE</span>
</div>

<div class="flex min-h-screen">

  <!-- ================= LEFT SIDEBAR ================= -->
  <aside id="sidebar"
  class="fixed lg:static inset-y-0 left-0 z-50 w-72 bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 overflow-y-auto">

    <div class="p-6">

      <div class="flex items-center gap-3 mb-8">
        <div class="w-10 h-10 rounded-xl bg-blue-600 text-white flex items-center justify-center font-bold">IK</div>
        <h1 class="text-xl font-bold">IKIZULIVE</h1>
      </div>

      <!-- Admin Login -->
      <div class="mb-8">
        <label class="block text-sm mb-2">รหัสแอดมิน</label>
        <input type="password" id="adminCode"
          class="w-full px-4 py-3 rounded-lg border dark:border-gray-700 dark:bg-gray-800"/>
        <button onclick="checkAdmin()"
          class="mt-3 w-full bg-black text-white py-3 rounded-lg">
          เข้าสู่ระบบ
        </button>
        <p id="adminStatus" class="text-sm mt-2 text-center">
          ยังไม่ได้เข้าสู่ระบบ
        </p>
      </div>

      <!-- Add Posts -->
      <div>
        <h3 class="font-semibold mb-3">เพิ่มหลายโพสต์</h3>
        <textarea id="linkInput" rows="5"
          class="w-full px-4 py-3 rounded-lg border dark:border-gray-700 dark:bg-gray-800 mb-3"
          placeholder="https://twitter.com/..."></textarea>

        <textarea id="translateInput" rows="4"
          class="w-full px-4 py-3 rounded-lg border dark:border-gray-700 dark:bg-gray-800 mb-3"
          placeholder="คำแปล / บันทึก"></textarea>

        <button onclick="addPosts()"
          class="w-full bg-blue-600 text-white py-3 rounded-lg">
          เพิ่มโพสต์
        </button>
      </div>

    </div>
  </aside>

  <!-- ================= MAIN CONTENT ================= -->
  <main class="flex-1 max-w-5xl mx-auto p-4 md:p-8 pt-20 lg:pt-8 overflow-y-auto">

    <header class="mb-8">
      <h2 class="text-2xl md:text-3xl font-bold">Timeline โพสต์</h2>
      <p class="text-gray-500 dark:text-gray-400 text-sm md:text-base">
        จัดการ Twitter embeds และคำแปล
      </p>
    </header>

    <div id="posts" class="space-y-6"></div>

  </main>

  <!-- ================= RIGHT SIDEBAR ================= -->
  <aside class="hidden xl:block w-72 bg-white dark:bg-gray-900 border-l border-gray-200 dark:border-gray-800 overflow-y-auto">
    <div class="p-6">
      <h3 class="font-semibold mb-4">ตัวกรองเวลา</h3>
      <button onclick="showAll()"
        class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800">
        แสดงทั้งหมด
      </button>
      <div id="timelineButtons" class="mt-4 space-y-2"></div>
    </div>
  </aside>

</div>

<!-- ================= JS ================= -->

<script>
function toggleSidebar(){
  document.getElementById("sidebar")
    .classList.toggle("-translate-x-full");
}
</script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, deleteDoc, updateDoc, doc, onSnapshot, query, orderBy, Timestamp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const ADMIN_PASSWORD = "6767";
let isAdmin = false;

window.checkAdmin = () => {
  const input = document.getElementById("adminCode").value.trim();
  const status = document.getElementById("adminStatus");

  if(input === ADMIN_PASSWORD){
    isAdmin = true;
    status.textContent = "เข้าสู่ระบบสำเร็จ ✓";
    status.className = "text-green-600 text-sm mt-2 text-center";
  } else {
    status.textContent = "รหัสไม่ถูกต้อง ✗";
    status.className = "text-red-600 text-sm mt-2 text-center";
  }
};

const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "ikizuliveth.firebaseapp.com",
  projectId: "ikizuliveth",
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const postsRef = collection(db,"posts");

const postsContainer = document.getElementById("posts");
const timelineContainer = document.getElementById("timelineButtons");

let allPosts = [];

function render(posts){
  postsContainer.innerHTML="";
  posts.forEach(p=>{
    const card=document.createElement("div");
    card.className="bg-white dark:bg-gray-900 rounded-xl shadow border dark:border-gray-800 p-5 card-hover transition";

    let tweets="";
    p.postIds.forEach(id=>{
      tweets+=`<blockquote class="twitter-tweet"><a href="https://twitter.com/i/status/${id}"></a></blockquote>`;
    });

    card.innerHTML=`
      ${tweets}
      <button onclick="toggleTranslate('${p.id}')"
        class="mt-4 bg-gray-200 dark:bg-gray-800 px-4 py-2 rounded-lg">
        ดูคำแปล
      </button>
      <div id="trans-${p.id}" class="hidden mt-4 text-gray-600 dark:text-gray-300 whitespace-pre-line">
        ${p.content || "ยังไม่มีคำแปล"}
      </div>
    `;
    postsContainer.appendChild(card);
  });

  if(window.twttr) window.twttr.widgets.load();
}

window.toggleTranslate=(id)=>{
  document.getElementById("trans-"+id).classList.toggle("hidden");
};

window.addPosts=async()=>{
  const links=document.getElementById("linkInput").value.trim().split("\n").filter(Boolean);
  const translate=document.getElementById("translateInput").value.trim();

  const postIds=links.map(link=>link.match(/status\/(\d+)/)?.[1]).filter(Boolean);
  if(postIds.length===0) return alert("ไม่พบลิงก์");

  await addDoc(postsRef,{
    postIds,
    content:translate,
    createdAt:Timestamp.now()
  });

  document.getElementById("linkInput").value="";
  document.getElementById("translateInput").value="";
};

const q=query(postsRef,orderBy("createdAt","asc"));

onSnapshot(q,snapshot=>{
  allPosts=[];
  snapshot.forEach(docSnap=>{
    allPosts.push({id:docSnap.id,...docSnap.data()});
  });
  render(allPosts);
});
</script>

<script async src="https://platform.twitter.com/widgets.js"></script>

</body>
</html>
