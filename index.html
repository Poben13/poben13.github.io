<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>X Translation Archive</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #f5f8fa;
}

.container {
  display: grid;
  grid-template-columns: 250px 1fr 250px;
  height: 100vh;
}

.sidebar {
  background: white;
  padding: 20px;
  border-right: 1px solid #ddd;
  overflow-y: auto;
}

.feed {
  padding: 20px;
  overflow-y: auto;
}

.timeline {
  background: white;
  padding: 20px;
  border-left: 1px solid #ddd;
  overflow-y: auto;
}

.post-group {
  background: white;
  padding: 15px;
  margin-bottom: 25px;
  border-radius: 12px;
}

.translation {
  display: none;
  background: #f0f0f0;
  padding: 10px;
  margin-top: 10px;
  border-radius: 8px;
  white-space: pre-wrap;
}

button {
  margin-top: 10px;
  padding: 6px 10px;
  border: none;
  background: black;
  color: white;
  cursor: pointer;
  border-radius: 5px;
  margin-right: 5px;
}

.delete-btn {
  background: #d11a2a;
}

textarea {
  width: 100%;
  padding: 6px;
  margin-top: 5px;
  box-sizing: border-box;
}

.month-btn {
  display: block;
  width: 100%;
  margin-bottom: 8px;
  background: #333;
}
</style>
</head>

<body>

<div class="container">

<!-- ‡∏ã‡πâ‡∏≤‡∏¢ -->
<div class="sidebar">
  <h3>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏•‡∏≤‡∏¢‡πÇ‡∏û‡∏™‡∏ï‡πå</h3>

  <label>‡∏•‡∏¥‡∏á‡∏Å‡πå (1 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î = 1 ‡∏•‡∏¥‡∏á‡∏Å‡πå)</label>
  <textarea id="postUrls" rows="5"></textarea>

  <label>‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•</label>
  <textarea id="postTranslation" rows="4"></textarea>

  <button onclick="addPostGroup()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏û‡∏™‡∏ï‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
</div>

<!-- ‡∏Å‡∏•‡∏≤‡∏á -->
<div class="feed"></div>

<!-- ‡∏Ç‡∏ß‡∏≤ -->
<div class="timeline">
  <h3>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h3>
  <div id="monthList"></div>
  <button onclick="showAll()">‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
</div>

</div>

<script async src="https://platform.twitter.com/widgets.js"></script>

<script>

function toggle(button) {
  const translation = button.parentElement.parentElement.querySelector(".translation");

  if (!translation.style.display || translation.style.display === "none") {
    translation.style.display = "block";
    button.innerText = "‡∏ã‡πà‡∏≠‡∏ô‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•";
  } else {
    translation.style.display = "none";
    button.innerText = "‡∏î‡∏π‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•";
  }
}

function addPostGroup() {
  const urlsText = document.getElementById("postUrls").value.trim();
  const translation = document.getElementById("postTranslation").value.trim();

  if (!urlsText) {
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå");
    return;
  }

  const urls = urlsText.split("\n")
    .map(url => url.trim())
    .filter(url => url !== "")
    .map(url => url.replace("x.com", "twitter.com").split("?")[0]);

  const id = Date.now();
  const createdAt = new Date().toISOString();

  createPostGroup(id, urls, translation, createdAt, true);

  document.getElementById("postUrls").value = "";
  document.getElementById("postTranslation").value = "";
}

function createPostGroup(id, urls, translation, createdAt, save=false) {
  const feed = document.querySelector(".feed");

  const groupDiv = document.createElement("div");
  groupDiv.className = "post-group";
  groupDiv.setAttribute("data-id", id);
  groupDiv.setAttribute("data-date", createdAt);

  let tweetsHTML = "";

  urls.forEach(url => {
    tweetsHTML += `
      <blockquote class="twitter-tweet">
        <a href="${url}"></a>
      </blockquote>
    `;
  });

  groupDiv.innerHTML = `
    ${tweetsHTML}
    <div>
      <button onclick="toggle(this)">‡∏î‡∏π‡∏Ñ‡∏≥‡πÅ‡∏õ‡∏•</button>
      <button class="delete-btn" onclick="deleteGroup(${id})">‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏ä‡∏∏‡∏î</button>
    </div>
    <div class="translation">${translation}</div>
  `;

  feed.appendChild(groupDiv); // üî• append ‡πÅ‡∏ó‡∏ô prepend (‡πÄ‡∏Å‡πà‡∏≤ ‚Üí ‡πÉ‡∏´‡∏°‡πà)

  if (window.twttr) {
    window.twttr.widgets.load(groupDiv);
  }

  if (save) {
    saveGroup(id, urls, translation, createdAt);
    renderMonths();
  }
}

function deleteGroup(id) {
  if (!confirm("‡∏•‡∏ö‡∏ä‡∏∏‡∏î‡∏ô‡∏µ‡πâ?")) return;

  document.querySelector(`[data-id='${id}']`).remove();

  let groups = JSON.parse(localStorage.getItem("groups")) || [];
  groups = groups.filter(g => g.id !== id);
  localStorage.setItem("groups", JSON.stringify(groups));

  renderMonths();
}

function saveGroup(id, urls, translation, createdAt) {
  let groups = JSON.parse(localStorage.getItem("groups")) || [];
  groups.push({ id, urls, translation, createdAt }); // üî• push ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡πÄ‡∏Å‡πà‡∏≤ ‚Üí ‡πÉ‡∏´‡∏°‡πà
  localStorage.setItem("groups", JSON.stringify(groups));
}

function loadGroups() {
  let groups = JSON.parse(localStorage.getItem("groups")) || [];

  groups.forEach(group => {
    createPostGroup(group.id, group.urls, group.translation, group.createdAt, false);
  });

  renderMonths();
}

function renderMonths() {
  const monthList = document.getElementById("monthList");
  monthList.innerHTML = "";

  let groups = JSON.parse(localStorage.getItem("groups")) || [];
  const months = {};

  groups.forEach(g => {
    const date = new Date(g.createdAt);
    const key = `${date.getFullYear()}-${date.getMonth()+1}`;
    months[key] = true;
  });

  Object.keys(months).sort().forEach(key => {
    const btn = document.createElement("button");
    btn.className = "month-btn";
    btn.innerText = key;
    btn.onclick = () => filterByMonth(key);
    monthList.appendChild(btn);
  });
}

function filterByMonth(monthKey) {
  const groups = document.querySelectorAll(".post-group");

  groups.forEach(group => {
    const date = new Date(group.dataset.date);
    const key = `${date.getFullYear()}-${date.getMonth()+1}`;

    group.style.display = (key === monthKey) ? "block" : "none";
  });
}

function showAll() {
  document.querySelectorAll(".post-group").forEach(group => {
    group.style.display = "block";
  });
}

document.addEventListener("DOMContentLoaded", loadGroups);

</script>

</body>
</html>
